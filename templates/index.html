<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vegetable Classifier</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        margin: 2em;
        background-color: #f4f4f9;
        color: #333;
      }
      .container {
        max-width: 600px;
        margin: auto;
        background: #fff;
        padding: 2em;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      h1,
      h2 {
        color: #333;
      }
      .status {
        padding: 1em;
        border-radius: 5px;
        margin-bottom: 1em;
        border: 1px solid transparent;
      }
      .status.ok {
        background-color: #d4edda;
        color: #155724;
        border-color: #c3e6cb;
      }
      .status.error {
        background-color: #f8d7da;
        color: #721c24;
        border-color: #f5c6cb;
      }
      form {
        margin-top: 1.5em;
      }
      input[type='file'] {
        display: block;
        margin-bottom: 1em;
      }
      button {
        background-color: #007bff;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1em;
      }
      button:hover {
        background-color: #0056b3;
      }
      .results {
        margin-top: 2em;
        padding-top: 1em;
        border-top: 1px solid #eee;
      }
      ul {
        list-style-type: none;
        padding: 0;
      }
      li {
        background: #f9f9f9;
        margin-bottom: 0.5em;
        padding: 0.5em;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Vegetable Classifier</h1>
      <div class="status {{ status }}">
        <strong>Status:</strong> {{ message }}
      </div>

      {% if status == 'ok' %}
        <h2>Upload an Image to Classify</h2>
        <form id="upload-form">
          <input type="file" name="file" id="file-input" accept="image/*" required />
          <button type="submit">Predict</button>
        </form>
        <div id="results" class="results"></div>
      {% endif %}
    </div>

    <script>
      const form = document.getElementById('upload-form')
      const resultsDiv = document.getElementById('results')
      
      if (form) {
        form.addEventListener('submit', async (e) => {
          e.preventDefault()
          resultsDiv.innerHTML = '<p>Processing...</p>'
      
          const formData = new FormData(form)
          try {
            const response = await fetch('/predict', {
              method: 'POST',
              body: formData
            })
      
            if (!response.ok) {
              const errorData = await response.json()
              throw new Error(errorData.error || `HTTP error! Status: ${response.status}`)
            }
      
            const data = await response.json()
            let html = `<h3>Prediction: <strong>${data.predicted_vegetable}</strong> (${(data.confidence * 100).toFixed(2)}%)</h3><h4>Top 3 Results:</h4><ul>`
            data.top_predictions.forEach((pred) => {
              html += `<li>${pred.vegetable}: ${(pred.confidence * 100).toFixed(2)}%</li>`
            })
            html += '</ul>'
            resultsDiv.innerHTML = html
          } catch (error) {
            resultsDiv.innerHTML = `<p style="color: red;"><strong>Error:</strong> ${error.message}</p>`
          }
        })
      }
    </script>
  </body>
</html>
